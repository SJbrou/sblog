<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Scraping the VU site - </title>
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/assets/js/codecopy.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
</head>
<body>
  <div class="container">
    <main>
      <article class="post">
  <header>
    <h1>Scraping the VU site</h1>
  </header>

  <!-- Optional Excerpt -->
  
    <section class="post-excerpt">
      <p><link rel="stylesheet" href="/assets/css/prism.css" />

<script src="/assets/js/prism.js"></script>

</p>
    </section>
  

  <!-- Main Content -->
  
  
    <section class="content">
      <p>Finding course info on the VU page is a pain. lets scrape all active courses from their site and create a querriable database using R!
<!-- excerpt --></p>

<p>As I like to follow extracurricular courses, I have to check what courses are available during what semester (period). However, the VU site provides no suchs availability. Lets create it ourselves by scraping all active courses from the VU site, and combining the data in a csv file which we <em>can</em> query.</p>

<p><img src="/assets/content/scraping_the_vu_site/vu_site.png" alt="Why is querying the period impossible?!" style="width:100%; border-radius:10px; background-color:#f0f0f0; padding:0.6rem; display:block; margin:1rem auto;" /></p>

<p>Follow the links to the 
<a href="https://github.com/SJbrou/scraping-vu">github</a>, <a href="asd">code page</a> and <a href="https://github.com/SJbrou/scraping-vu/blob/main/scraped_courses.csv">final results .csv</a></p>

<p>The code and explanation follow</p>

<p>While browsing the VU website, I found their “Studiegids” to be a pain.<br />
I wanted to apply for some extra courses, and sorting them on semester/period or required prior knowledge was impossible.<br />
Thus, it seemed a perfect opportunity to practice some web-scraping skills.</p>

<p>The <a href="https://research.vu.nl/en/courses/?year=2024&amp;ordering=title&amp;descending=false&amp;format=rss&amp;page=">VU website</a> only shows 50 pages of 50 results, while there are ~3500 different courses. Lets querry them orderd on title both ascendingly and descendingly, and find all unique urls.</p>

<p>Lets start by cleaning the worksapce and loading required dependencies</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># a nice function to clear the worksapce and install + load required packages</span><span class="w">

</span><span class="c1"># Clear workspace</span><span class="w">
</span><span class="n">rm</span><span class="p">(</span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ls</span><span class="p">())</span><span class="w">


</span><span class="c1"># Function to load packages, and install them if necessary.</span><span class="w">
</span><span class="n">install_and_load</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">packages</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">installed_packages</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rownames</span><span class="p">(</span><span class="n">installed.packages</span><span class="p">())</span><span class="w">                                </span><span class="c1"># Check installed packages</span><span class="w">
  </span><span class="n">to_install</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">packages</span><span class="p">[</span><span class="o">!</span><span class="p">(</span><span class="n">packages</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">installed_packages</span><span class="p">)]</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">to_install</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">                                                       </span><span class="c1"># Install missing</span><span class="w">
    </span><span class="n">install.packages</span><span class="p">(</span><span class="n">to_install</span><span class="p">,</span><span class="w"> </span><span class="n">dependencies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="n">suppressMessages</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span><span class="w"> </span><span class="n">require</span><span class="p">,</span><span class="w"> </span><span class="n">character.only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">quietly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">  </span><span class="c1"># Load</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="n">install_and_load</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"xml2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"rvest"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dplyr"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Lets scrape all URL’s linking to course pages from the search page. As only 2500 out of ~3600 pages are returend, we have to request all courses both ascendingly and descendingly. We can filter for duplacates later.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Initialize base URLs and page numbers</span><span class="w">
</span><span class="n">asc_url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://research.vu.nl/en/courses/?year=2024&amp;ordering=title&amp;descending=false&amp;format=rss&amp;page="</span><span class="w">
</span><span class="n">desc_url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"https://research.vu.nl/en/courses/?year=2024&amp;ordering=title&amp;descending=true&amp;format=rss&amp;page="</span><span class="w">
</span><span class="n">url_incr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">49</span><span class="w">  </span><span class="c1"># Assuming pagination goes from page 0 to 49</span><span class="w">

</span><span class="c1"># Define a function to fetch links from RSS feed pages</span><span class="w">
</span><span class="n">fetch_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">url_incr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  

  </span><span class="n">links_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="c1"># Loop through each page</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">url_incr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    
    </span><span class="c1"># Construct the full URL for the current page</span><span class="w">
    </span><span class="n">url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Read the RSS feed XML content</span><span class="w">
    </span><span class="n">rss_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_xml</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Extract all &lt;link&gt; elements</span><span class="w">
    </span><span class="n">links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xml_find_all</span><span class="p">(</span><span class="n">rss_content</span><span class="p">,</span><span class="w"> </span><span class="s2">".//link"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># exclude first link</span><span class="w">
    </span><span class="n">link_texts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">xml_text</span><span class="p">(</span><span class="n">links</span><span class="p">[</span><span class="m">-1</span><span class="p">])</span><span class="w">
    
    </span><span class="c1"># Here all new links are appended. Could optimize by initializing length first. but at 3k entries this shouldn't be an issue. I'm just lazy here</span><span class="w">
    </span><span class="n">links_list</span><span class="p">[[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">link_texts</span><span class="w">
    
    </span><span class="c1"># A small delay to avoid overloading the server. Was expecting to be rate limited but 0.1 seemed just fine</span><span class="w">
    </span><span class="n">Sys.sleep</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
  
  </span><span class="c1"># Return the combined list of links</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">unlist</span><span class="p">(</span><span class="n">links_list</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">


</span><span class="n">asc_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fetch_links</span><span class="p">(</span><span class="n">asc_url</span><span class="p">,</span><span class="w"> </span><span class="n">url_incr</span><span class="p">)</span><span class="w">
</span><span class="n">desc_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fetch_links</span><span class="p">(</span><span class="n">desc_url</span><span class="p">,</span><span class="w"> </span><span class="n">url_incr</span><span class="p">)</span><span class="w">

</span><span class="c1"># Filter for duplicates and show some results</span><span class="w">
</span><span class="n">all_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">asc_links</span><span class="p">,</span><span class="w"> </span><span class="n">desc_links</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">all_links</span><span class="p">)</span><span class="w">




</span><span class="c1"># Some code to save and load all links as RDS data so the VU site only had to be scraped once.</span><span class="w">

</span><span class="c1"># save all_links to an file</span><span class="w">
</span><span class="c1"># saveRDS(all_links, "all_links.RDS")</span><span class="w">

</span></code></pre></div></div>

<p>These url’s all lead to research.vu.nl pages that contain many different links. We are only interested in links containing “studiegids”. lets loop through all pages and store all links containing “studielink” and thus lead to the information page.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">studiegids_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="s2">"character"</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3575</span><span class="p">)</span><span class="w">
</span><span class="n">counter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">


</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">all_links</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  
  </span><span class="n">tryCatch</span><span class="p">({</span><span class="w">
    </span><span class="c1"># Read HTML of reasearch.vu</span><span class="w">
    </span><span class="n">html_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Look for node with link to studiegids</span><span class="w">
    </span><span class="n">studiegids_nodes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">html_nodes</span><span class="p">(</span><span class="n">html_content</span><span class="p">,</span><span class="w"> </span><span class="n">xpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"//h2[@class='subheader' and text()='URL study guide']/following-sibling::a[1]"</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Extract href</span><span class="w">
    </span><span class="n">href_values</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">html_attr</span><span class="p">(</span><span class="n">studiegids_nodes</span><span class="p">,</span><span class="w"> </span><span class="s2">"href"</span><span class="p">)</span><span class="w">
    </span><span class="n">studiegids_links</span><span class="p">[[</span><span class="n">counter</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">href_values</span><span class="w">
    
    </span><span class="c1"># Print progress every 10 iterations</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">counter</span><span class="w"> </span><span class="o">%%</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Processed"</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span><span class="w"> </span><span class="s2">"out of"</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">all_links</span><span class="p">),</span><span class="w"> </span><span class="s2">"URLs\n"</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
    
    </span><span class="c1"># Increment the counter only if tryCatch was successful</span><span class="w">
    </span><span class="n">counter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="p">},</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># error message</span><span class="w">
    </span><span class="n">message</span><span class="p">(</span><span class="s2">"Error in URL: "</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">studiegids_links</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">studiegids_links</span><span class="p">)</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">studiegids_links</span><span class="p">)</span><span class="w">


</span><span class="c1"># Some code to save and load all links as RDS data so the VU site only had to be scraped once.</span><span class="w">

</span><span class="c1"># Save studiegids_links to an R file</span><span class="w">
</span><span class="c1"># saveRDS(studiegids_links, "studiegids_links.RDS")   # saving results in between here. </span><span class="w">

</span></code></pre></div></div>

<p>Each of the links in the list “studiegids_links” links to a webpage with the info we want to scrape. I’d like to scrape the following data into a dataframe:</p>

<p>The course title as in:
&lt;div id=”title”&gt;
&lt;h2&gt;Academic Skills Literature and Society 2&lt;/h2&gt;</p>

<p>from the &lt;div class=”course-data”&gt;</p>
<ul>
  <li>from the table the values of the &lt;td&gt; under the following &lt;th&gt;’s (each in a separate column)
    <ul>
      <li>“Course Code”</li>
      <li>“Credits”</li>
      <li>“Period”</li>
      <li>“Course Level”</li>
      <li>“Faculty”</li>
      <li>“Course Coordinator”</li>
      <li>“Examiner”</li>
      <li>“Teaching staff”</li>
    </ul>
  </li>
</ul>

<p>There also is a &lt;div class=”h3 course-data-header”&gt;Target audiences&lt;/div&gt;. I would like all the text values of the href’s that are child elements of it. Store them into one column.</p>

<p>If there exists an &lt;h3&gt;Entry Requirements&lt;/h3&gt; I would like the text value of its child element (&lt;p&gt;)
If there exists an &lt;h3&gt;Course Content&lt;/h3&gt; I would like the text value of its child element (&lt;p&gt;)</p>

<p>Finally, also store the link used to access it in the dataframe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Number of pages to scrape</span><span class="w">
</span><span class="n">num_pages</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3526</span><span class="w"> </span><span class="c1"># might change. In hindsight I should have called length() to determine this</span><span class="w">

</span><span class="c1"># Initialize an empty dataframe of 3526 rows x 13 columns. This time I wasn't lazy :)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
  </span><span class="n">Title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Course_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Credits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Course_Level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Faculty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Course_Coordinator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Examiner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Teaching_Staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Target_Audiences</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Entry_Requirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">Course_Content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">num_pages</span><span class="p">),</span><span class="w">
  </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="c1"># Global counter for progress</span><span class="w">
</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="c1"># Start from the first row</span><span class="w">

</span><span class="c1"># Define a function to scrape data from a single URL and fill the dataframe row by row</span><span class="w">
</span><span class="n">scrape_course_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tryCatch</span><span class="p">({</span><span class="w">
    </span><span class="c1"># Read the HTML content of the page</span><span class="w">
    </span><span class="n">page</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Course title</span><span class="w">
    </span><span class="n">course_title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_node</span><span class="p">(</span><span class="s2">"#title h2"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_text</span><span class="p">(</span><span class="n">trim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
    
    </span><span class="c1"># Course data table (if it exists)</span><span class="w">
    </span><span class="n">course_data_node</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_node</span><span class="p">(</span><span class="s2">".course-data"</span><span class="p">)</span><span class="w">

    </span><span class="c1"># If the course data table exists, extract it as a data frame</span><span class="w">
    </span><span class="n">course_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">course_data_node</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">html_table</span><span class="p">(</span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

    </span><span class="c1"># Extract details from course data table</span><span class="w">
    </span><span class="n">course_code</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">credits</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">period</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">course_level</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">faculty</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">course_coordinator</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">examiner</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">
    </span><span class="n">teaching_staff</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.character</span><span class="p">(</span><span class="n">course_data</span><span class="p">[</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="w">

    </span><span class="c1"># Extract Target Audiences under &lt;div class="h3 course-data-header"&gt;Target audiences&lt;/div&gt;</span><span class="w">
    </span><span class="n">target_audiences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_node</span><span class="p">(</span><span class="n">xpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"//div[@class='h3 course-data-header' and contains(text(), 'Target audiences')]/following-sibling::div"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_nodes</span><span class="p">(</span><span class="s2">"a"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_text</span><span class="p">(</span><span class="n">trim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">paste</span><span class="p">(</span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">", "</span><span class="p">)</span><span class="w">  </span><span class="c1"># Combine into a single string</span><span class="w">

    </span><span class="c1"># Extract Entry Requirements text, if it exists</span><span class="w">
    </span><span class="n">entry_requirements</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_node</span><span class="p">(</span><span class="n">xpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"//h3[contains(text(), 'Entry Requirements')]/following-sibling::p"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_text</span><span class="p">(</span><span class="n">trim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="p">{</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">.</span><span class="p">}</span><span class="w">

    </span><span class="c1"># Extract Course Content text, if it exists</span><span class="w">
    </span><span class="n">course_content</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_node</span><span class="p">(</span><span class="n">xpath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"//h3[contains(text(), 'Course Content')]/following-sibling::p"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="n">html_text</span><span class="p">(</span><span class="n">trim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
      </span><span class="p">{</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">is.null</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="kc">NA</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="n">.</span><span class="p">}</span><span class="w">

    </span><span class="c1"># Increment counter and show progress</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Scraped page"</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="s2">":"</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">

    </span><span class="c1"># fill dataframe with scraped data</span><span class="w">
    </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">course_title</span><span class="p">,</span><span class="w"> </span><span class="n">course_code</span><span class="p">,</span><span class="w"> </span><span class="n">credits</span><span class="p">,</span><span class="w"> </span><span class="n">period</span><span class="p">,</span><span class="w"> </span><span class="n">course_level</span><span class="p">,</span><span class="w"> </span><span class="n">faculty</span><span class="p">,</span><span class="w"> 
                    </span><span class="n">course_coordinator</span><span class="p">,</span><span class="w"> </span><span class="n">examiner</span><span class="p">,</span><span class="w"> </span><span class="n">teaching_staff</span><span class="p">,</span><span class="w"> </span><span class="n">target_audiences</span><span class="p">,</span><span class="w"> 
                    </span><span class="n">entry_requirements</span><span class="p">,</span><span class="w"> </span><span class="n">course_content</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">)</span><span class="w">
    
    </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="w">

  </span><span class="p">},</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="c1"># error handling</span><span class="w">
    </span><span class="n">cat</span><span class="p">(</span><span class="s2">"Error scraping"</span><span class="p">,</span><span class="w"> </span><span class="n">url</span><span class="p">,</span><span class="w"> </span><span class="s2">"\n"</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Now run for each url we gathered</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">studiegids_links</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">scrape_course_data</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Final dataframe!</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="s2">"VU_courses"</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Tada! now we can query the courses as intended!</p>

    </section>
  
</article>

<!-- Feed / Related Thoughts Section -->
<section id="feed">
  <!-- Show "Related" if show-feed-title is true or not defined -->
  
    <h1>Related</h1>  <!-- Display "Related" if show-feed-title is true or undefined -->
  

  <ul>
     <!-- Sort posts by date (newest first) -->

    
    
     <!-- Get the current year -->

    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
            <div class="month-separator-space"></div>
            <div class="month-separator">
              <span>November</span>
            </div>
            
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/projects/2024/11/16/HEIC-to-JPG-while-keeping-metadata">HEIC to JPG while keeping metadata</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  16th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          
            
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
            <div class="month-separator-space"></div>
            <div class="month-separator">
              <span>October</span>
            </div>
            
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/VU/2024/10/31/Misaligned-incentives-in-university-education">Misaligned incentives in university education</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  31th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/VU/2024/10/30/Nudges-in-the-nudge-course">Nudges in the Nudge course</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  30th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/projects/2024/10/28/Site-todo">Site todo</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  28th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/vu/2024/10/23/DTS-portfolio">DTS Portfolio introduction</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  23th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        
          
            
            

        
          <!-- Skip the current post itself -->
          

          <!-- Display year separator if post year differs and is not the current year -->
          

          <!-- Display month separator if post month differs -->
          
    
          <li>
            <div class="post-entry">
              <span class="post-title"><a href="/VU/2024/10/22/Followed-courses">Followed courses</a></span>
              <div class="post-separator"></div>
              <span class="post-date">
                
                
                
                  22th
                  
                
              </span>
            </div>
          </li>
        
      
    
      
      

      <!-- For Post Pages: Filter posts for the same category -->
      

      <!-- Show only related posts based on category -->
      
        
        
        
        <!-- Check if any category in post.categories matches any category in page.categories -->
        

        
      
    
  </ul>
</section>


    </main>
  </div>
</body>
</html>

<link rel="stylesheet" href="/assets/css/styles.css">

<!-- Footer Content -->
<div class="footer-content">
  
</div>

<!-- Separator -->
<div class="footer-separator">
  <span class="rotated-symbol">§</span>
  <span class="rotated-symbol">§</span>
  <span class="rotated-symbol">§</span>
</div>

<!-- Footer Navigation -->
<div class="footer-nav">
  
    <span class="footer-span">
      <a href="/me.html">Me</a>
    </span>
  
    <span class="footer-span">
      <a href="/">Thoughts</a>
    </span>
  
    <span class="footer-span">
      <a href="/projects">Projects</a>
    </span>
  
    <span class="footer-span">
      <a href="/vu">VU</a>
    </span>
  
    <span class="footer-span">
      <a href="/favourites.html">Favs</a>
    </span>
  
</div>
